# 账户管理 API

## 1. 账户列表

### 接口信息

- **路径**: `/api/accounts/`
- **方法**: `GET`
- **认证**: 需要
- **描述**: 获取当前用户的所有账户

### 请求头

```
Authorization: Bearer <access_token>
```

### 响应示例

```json
[
  {
    "id": "uuid-string",
    "name": "我的账户",
    "parent": null,
    "is_default": true,
    "holding_cost": "10000.00",
    "holding_value": "12000.00",
    "pnl": "2000.00",
    "pnl_rate": "0.2000",
    "estimate_value": "12500.00",
    "estimate_pnl": "2500.00",
    "estimate_pnl_rate": "0.2500",
    "today_pnl": "500.00",
    "today_pnl_rate": "0.0417",
    "children": [
      {
        "id": "uuid-string-2",
        "name": "子账户",
        "parent": "uuid-string",
        "is_default": false,
        "holding_cost": "10000.00",
        "holding_value": "12000.00",
        "pnl": "2000.00",
        "pnl_rate": "0.2000",
        "estimate_value": "12500.00",
        "estimate_pnl": "2500.00",
        "estimate_pnl_rate": "0.2500",
        "today_pnl": "500.00",
        "today_pnl_rate": "0.0417",
        "created_at": "2024-01-02T00:00:00Z",
        "updated_at": "2024-01-02T00:00:00Z"
      }
    ],
    "created_at": "2024-01-01T00:00:00Z",
    "updated_at": "2024-01-01T00:00:00Z"
  }
]
```

### 响应字段

| 字段 | 类型 | 说明 |
|------|------|------|
| id | uuid | 账户 ID |
| name | string | 账户名称 |
| parent | uuid/null | 父账户 ID，null 表示顶级账户 |
| is_default | boolean | 是否为默认账户 |
| holding_cost | decimal | 持仓成本（父账户汇总子账户，子账户汇总持仓） |
| holding_value | decimal | 持仓市值（基于 latest_nav） |
| pnl | decimal | 总盈亏 |
| pnl_rate | decimal | 收益率（可为 null） |
| estimate_value | decimal | 预估市值（基于 estimate_nav，可为 null） |
| estimate_pnl | decimal | 预估盈亏（可为 null） |
| estimate_pnl_rate | decimal | 预估收益率（可为 null） |
| today_pnl | decimal | 今日盈亏（可为 null） |
| today_pnl_rate | decimal | 今日收益率（可为 null） |
| children | array | 子账户列表（仅父账户返回，子账户不返回此字段） |
| created_at | datetime | 创建时间 |
| updated_at | datetime | 更新时间 |

### 状态码

- `200` - 成功
- `401` - 未认证

---

## 2. 创建账户

### 接口信息

- **路径**: `/api/accounts/`
- **方法**: `POST`
- **认证**: 需要
- **描述**: 创建新账户

### 请求参数

```json
{
  "name": "我的账户",
  "parent": null,
  "is_default": false
}
```

### 请求字段

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| name | string | 是 | 账户名称 |
| parent | uuid | 否 | 父账户 ID |
| is_default | boolean | 否 | 是否设为默认账户 |

### 响应示例

```json
{
  "id": "uuid-string",
  "name": "我的账户",
  "parent": null,
  "is_default": false,
  "holding_cost": "0.00",
  "holding_value": "0.00",
  "pnl": "0.00",
  "pnl_rate": null,
  "estimate_value": "0.00",
  "estimate_pnl": "0.00",
  "estimate_pnl_rate": null,
  "today_pnl": "0.00",
  "today_pnl_rate": null,
  "children": [],
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

### 状态码

- `201` - 创建成功
- `400` - 参数错误
- `401` - 未认证

---

## 3. 账户详情

### 接口信息

- **路径**: `/api/accounts/{id}/`
- **方法**: `GET`
- **认证**: 需要
- **描述**: 获取账户详细信息

### 路径参数

| 参数 | 类型 | 说明 |
|------|------|------|
| id | uuid | 账户 ID |

### 响应示例

```json
{
  "id": "uuid-string",
  "name": "我的账户",
  "parent": null,
  "is_default": true,
  "holding_cost": "10000.00",
  "holding_value": "12000.00",
  "pnl": "2000.00",
  "pnl_rate": "0.2000",
  "estimate_value": "12500.00",
  "estimate_pnl": "2500.00",
  "estimate_pnl_rate": "0.2500",
  "today_pnl": "500.00",
  "today_pnl_rate": "0.0417",
  "children": [
    {
      "id": "uuid-string-2",
      "name": "子账户",
      "parent": "uuid-string",
      "is_default": false,
      "holding_cost": "10000.00",
      "holding_value": "12000.00",
      "pnl": "2000.00",
      "pnl_rate": "0.2000",
      "estimate_value": "12500.00",
      "estimate_pnl": "2500.00",
      "estimate_pnl_rate": "0.2500",
      "today_pnl": "500.00",
      "today_pnl_rate": "0.0417",
      "created_at": "2024-01-02T00:00:00Z",
      "updated_at": "2024-01-02T00:00:00Z"
    }
  ],
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

### 状态码

- `200` - 成功
- `401` - 未认证
- `404` - 账户不存在

---

## 4. 更新账户

### 接口信息

- **路径**: `/api/accounts/{id}/`
- **方法**: `PUT` / `PATCH`
- **认证**: 需要
- **描述**: 更新账户信息

### 请求参数

```json
{
  "name": "新账户名",
  "is_default": true
}
```

### 响应示例

```json
{
  "id": "uuid-string",
  "name": "新账户名",
  "parent": null,
  "is_default": true,
  "holding_cost": "10000.00",
  "holding_value": "12000.00",
  "pnl": "2000.00",
  "pnl_rate": "0.2000",
  "estimate_value": "12500.00",
  "estimate_pnl": "2500.00",
  "estimate_pnl_rate": "0.2500",
  "today_pnl": "500.00",
  "today_pnl_rate": "0.0417",
  "children": [],
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

### 状态码

- `200` - 更新成功
- `400` - 参数错误
- `401` - 未认证
- `404` - 账户不存在

---

## 5. 删除账户

### 接口信息

- **路径**: `/api/accounts/{id}/`
- **方法**: `DELETE`
- **认证**: 需要
- **描述**: 删除账户

### 响应

无响应体

### 状态码

- `204` - 删除成功
- `401` - 未认证
- `404` - 账户不存在

---

## 6. 获取账户持仓

### 接口信息

- **路径**: `/api/accounts/{id}/positions/`
- **方法**: `GET`
- **认证**: 需要
- **描述**: 获取账户的所有持仓

### 路径参数

| 参数 | 类型 | 说明 |
|------|------|------|
| id | uuid | 账户 ID |

### 响应示例

```json
[
  {
    "id": "uuid-string",
    "account": "uuid-string",
    "fund": {
      "fund_code": "000001",
      "fund_name": "华夏成长混合"
    },
    "holding_share": "1000.00",
    "holding_cost": "12345.00",
    "avg_nav": "12.345",
    "pnl": "123.45",
    "pnl_rate": "1.00%",
    "created_at": "2024-01-01T00:00:00Z",
    "updated_at": "2024-01-02T00:00:00Z"
  }
]
```

### 响应字段

| 字段 | 类型 | 说明 |
|------|------|------|
| id | uuid | 持仓 ID |
| account | uuid | 账户 ID |
| fund | object | 基金信息 |
| holding_share | decimal | 持有份额 |
| holding_cost | decimal | 持有成本 |
| avg_nav | decimal | 平均净值 |
| pnl | decimal | 盈亏金额 |
| pnl_rate | string | 盈亏率 |

### 状态码

- `200` - 成功
- `401` - 未认证
- `404` - 账户不存在
