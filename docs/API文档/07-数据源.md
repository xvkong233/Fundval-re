# 数据源 API

## 1. 数据源列表

### 接口信息

- **路径**: `/api/sources/`
- **方法**: `GET`
- **认证**: 不需要
- **描述**: 获取所有可用的数据源

### 响应示例

```json
[
  {
    "name": "tiantian"
  },
  {
    "name": "danjuan"
  },
  {
    "name": "ths"
  }
]
```

### 响应字段

| 字段 | 类型 | 说明 |
|------|------|------|
| name | string | 数据源名称 |

### 状态码

- `200` - 成功

### 说明

- `tiantian` 兼容别名：`eastmoney`
- `ths` 兼容别名：`tonghuashun`、`10jqka`

---

## 2. 数据源整体准确率

### 接口信息

- **路径**: `/api/sources/{source_name}/accuracy/`
- **方法**: `GET`
- **认证**: 不需要
- **描述**: 获取数据源的整体准确率统计

### 路径参数

| 参数 | 类型 | 说明 |
|------|------|------|
| source_name | string | 数据源名称 |

### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| days | integer | 否 | 统计天数，默认 100 |

### 响应示例

```json
{
  "avg_error_rate": "0.0123",
  "record_count": 1500
}
```

### 响应字段

| 字段 | 类型 | 说明 |
|------|------|------|
| avg_error_rate | decimal | 平均误差率 |
| record_count | integer | 统计记录数量 |

### 状态码

- `200` - 成功

### 说明

- 误差率计算公式：`|估值 - 实际净值| / 实际净值`
- 统计最近 N 条记录（按日期倒序）
- 如果没有记录，返回 `avg_error_rate: 0, record_count: 0`

---

## 3. 数据源健康度

### 接口信息

- **路径**: `/api/sources/health/`
- **方法**: `GET`
- **认证**: 不需要
- **描述**: 探测各数据源上游连通性与解析健康度（用于运维页面展示）

### 响应示例

```json
[
  {
    "name": "tiantian",
    "ok": true,
    "latency_ms": 123,
    "error": null
  }
]
```

### 状态码

- `200` - 成功（单个数据源失败会体现在 `ok=false/error` 中）

---

## 4. 计算准确率（写回数据库）

### 接口信息

- **路径**: `/api/sources/{source_name}/accuracy/calculate/`
- **方法**: `POST`
- **认证**: 不需要（但需要数据库可用）
- **描述**: 对指定日期的估值记录补齐实际净值并计算误差率（写回 `estimate_accuracy` 表）

### 请求参数

```json
{
  "date": "2026-02-17"
}
```

### 响应示例

```json
{
  "source": "tiantian",
  "date": "2026-02-17",
  "total": 10,
  "success": 8,
  "failed": 2
}
```
