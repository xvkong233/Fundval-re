# 嗅探页 UI 深度重构 + 中性购买建议（设计稿）

日期：2026-02-21

## 目标

- 嗅探页提升为「数据密集型仪表盘」：筛选、表格、信号、建议同屏呈现，减少来回跳转。
- 购买建议采用「中性」口径：不激进，只在位置偏低且信号更强时进入“买入候选”。
- 解决前端信号拉取的循环依赖：**拉信号不依赖建议分桶**，避免重复请求/抖动。

## 数据流（核心）

- 输入：`/api/sniffer/items/` 返回嗅探列表（星级/回撤/涨幅/标签/板块等）。
- 信号：通过 `POST /api/funds/signals/batch` 批量拉取（最多 50 个）。
  - 候选 fund_codes 由 `filteredItems` 计算：优先星级较高或回撤更深的基金，稳定排序、去重、截断。
  - batch 场景只做 best-effort 快照，不触发训练（避免刷爆与阻塞）。
- 映射：将后端 `best_peer` 的嵌套字段（`dip_buy.p_20t` 等）扁平化成 `SnifferSignalsSummary`，便于建议逻辑与 UI 展示。

## 建议分桶（中性口径）

- 主要依据：
  - 位置桶：`low / medium / high`（20/60/20）
  - 抄底/反转概率：20T + 5T（短线参考）
  - 星级与最大回撤（嗅探源）
- buy（买入候选）：位置偏低 + 星级≥3 +（抄底或反转概率较高）
- avoid（回避）：位置偏高 + 星级≤3 + 抄底概率低/缺失
- 其余：watch（观望）

## UI 结构

参考 `design-system/fundval/MASTER.md` 与 `design-system/fundval/pages/sniffer.md`：

- 顶部：标题 + 数据源 + 快照时间 + 同步/刷新动作；展示信号覆盖（已加载/候选数）。
- KPI 条：总基金数、筛选后数量、板块数、标签数。
- 主区（12 栏）：左侧筛选与表格（含“信号（ML）”列），右侧粘性购买建议（Tabs：买入候选/观望/回避）。

## 风险与后续

- 批量信号目前逐基金计算快照，后续可做 SQL 批量读取/聚合以进一步提速。
- 若需要更强“短线策略”，可以在建议区域加入「5T 策略卡」：以 5T 概率/位置桶给出更明确的入场/分批建议。

